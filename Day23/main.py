#!/usr/bin/python3

FINAL_INPUT = """#.###########################################################################################################################################
#...#.........#...#.......#.....###.........#.....#...#...#...###...#...........#.....#.....#.......#...###...#...###.......###.........#...#
###.#.#######.#.#.#.#####.#.###.###.#######.#.###.#.#.#.#.#.#.###.#.#.#########.#.###.#.###.#.#####.#.#.###.#.#.#.###.#####.###.#######.#.#.#
###.#.#.......#.#.#.....#.#...#.###.#.......#...#...#...#.#.#.###.#.#.....#.....#...#.#.#...#...#...#.#.#...#.#.#...#.....#...#.#.......#.#.#
###.#.#.#######.#.#####.#.###.#.###.#.#########.#########.#.#.###.#.#####.#.#######.#.#.#.#####.#.###.#.#.###.#.###.#####.###.#.#.#######.#.#
#...#.#...#...#.#.#...#.#.#...#.#...#.#.>.>.###.#.........#.#.....#.....#.#.#...###.#.#.#...###.#.###.#.#...#.#...#...###.#...#.#.....#...#.#
#.###.###.#.#.#.#.#.#.#.#.#.###.#.###.#.#v#.###.#.#########.###########.#.#.#.#.###.#.#.###.###.#.###.#.###.#.###.###.###.#.###.#####.#.###.#
#.....#...#.#.#.#.#.#.#.#.#...#...#...#.#.#.....#...#.....#.....#.......#.#.#.#.#...#.#...#...#.#...#.#...#.#...#...#.....#.....#.....#.#...#
#######v###.#.#.#.#.#.#.#.###.#####.###.#.#########.#.###.#####.#.#######.#.#.#.#.###.###.###.#.###.#.###.#.###.###.#############.#####.#.###
###...#.>.#.#.#.#...#.#.#...#.....#...#.#.....#.....#.#...###...#.......#.#...#.#...#...#...#.#.#...#...#.#.#...#...#.............#...#.#.###
###.#.#v#.#.#.#.#####.#.###.#####.###.#.#####.#.#####.#.#####.#########.#.#####.###.###.###.#.#.#.#####.#.#.#.###.###.#############.#.#.#.###
#...#...#.#.#.#...#...#.###...#...###...#.....#.....#.#.>.>...#.........#.....#.###...#.....#...#...#...#...#...#...#.#...#...#...#.#.#.#.###
#.#######.#.#.###.#.###.#####.#.#########.#########.#.###v#####.#############.#.#####.#############.#.#########.###.#.#.#.#.#.#.#.#.#.#.#.###
#.#.....#...#.#...#.....###...#.#.......#.........#.#.###...###.....#.....#...#.....#...#...........#.......#...###.#.#.#...#.#.#.#.#...#...#
#.#.###.#####.#.###########.###.#.#####.#########.#.#.#####.#######.#.###.#.#######.###.#.#################.#.#####.#.#.#####.#.#.#.#######.#
#...###...#...#.......#...#...#.#.#...#...#...#...#.#.#...#...#.....#...#.#...#.....#...#.....#.....#...#...#.>.>.#.#.#.#.....#.#.#.#.......#
#########.#.#########.#.#.###.#.#.#.#.###.#.#.#.###.#.#.#.###.#.#######.#.###.#.#####.#######.#.###.#.#.#.#####v#.#.#.#.#.#####.#.#.#.#######
#.........#...#.....#.#.#.....#.#...#...#...#...###...#.#.###.#.#...#...#.....#...>.>.#.....#.#.###.#.#...###...#...#.#.#.......#...#.......#
#.###########.#.###.#.#.#######.#######.###############.#.###.#.#.#.#.#############v###.###.#.#.###.#.#######.#######.#.###################.#
#...........#.#...#.#.#...#...#.#...###...........#.....#.....#...#.#...#...........###...#.#.#.#...#.#...#...#...###.#.###.................#
###########.#.###.#.#.###.#.#.#.#.#.#############.#.###############.###.#.###############.#.#.#.#.###.#.#.#.###.#.###.#.###.#################
#...........#.....#.#.#...#.#.#.#.#.............#.#...............#.#...#.#...#.........#.#.#...#...#...#.#.....#...#.#.#...#.......#.......#
#.#################.#.#.###.#.#.#.#############.#.###############.#.#.###.#.#.#.#######.#.#.#######.#####.#########.#.#.#.###.#####.#.#####.#
#.#...............#...#.....#.#.#.......#...###...#...............#...###...#.#.#.......#.#...#...#.......###...#...#.#.#...#.#.....#.#.....#
#.#.#############.###########.#.#######.#.#.#######.#########################.#.#.#######.###.#.#.###########.#.#.###.#.###.#.#.#####.#.#####
#...#.............#...#...###.#.###...#...#.......#.......................###...#.....#...#...#.#.#...#.....#.#.#.###...###...#.#...#.#.....#
#####.#############.#.#.#.###.#.###.#.###########.#######################.###########.#.###.###.#.#.#.#.###.#.#.#.#############.#.#.#.#####.#
#...#...#...........#.#.#.###...#...#.............#...###.......#...#...#.#...........#...#.###.#.#.#.#.#...#.#.#.#...###...###...#...#.....#
#.#.###.#.###########.#.#.#######.#################.#.###.#####.#.#.#.#.#.#.#############.#.###.#.#.#.#.#.###.#.#v#.#.###.#.###########v#####
#.#...#...#...#.......#.#...#.....#.................#...#.....#...#...#...#.#...#...#.....#...#.#.#.#.#.#.#...#.>.>.#.#...#...#.....#.>.#####
#.###.#####.#.#.#######.###.#.#####.###################.#####.#############.#.#.#.#.#.#######.#.#.#.#.#.#.#.#####v###.#.#####.#.###.#.#v#####
#...#.......#.#...#...#...#.#.....#.#...................#####...#...#...###...#...#.#...###...#.#.#.#.#.#.#.#...#.###...#####.#.###...#.....#
###.#########.###.#.#.###.#.#####.#.#.#########################.#.#.#.#.###########.###.###.###.#.#.#.#.#.#.#.#.#.###########.#.###########.#
#...#...#...#.....#.#.###.#.#...#...#.........#...#...###.......#.#.#.#...###...#...###...#.#...#.#.#...#...#.#.#.........#...#.###.........#
#.###.#v#.#.#######.#.###.#.#.#.#############.#.#.#.#.###.#######.#.#.###.###.#.#.#######.#.#.###.#.#########.#.#########.#.###.###.#########
#...#.#.>.#...###...#...#.#.#.#...#...#...#...#.#.#.#...#.......#.#.#...#.###.#.#...#.....#...###...###...#...#...#...#...#.....#...#...#...#
###.#.#v#####.###.#####.#.#.#.###.#.#.#.#.#.###.#.#.###.#######.#.#.###.#.###.#.###v#.#################.#.#.#####.#.#.#.#########.###.#.#.#.#
#...#.#...###...#...#...#.#.#.#...#.#.#.#.#.###.#.#.#...#...#...#.#...#.#.#...#.#.>.>.###.......#...#...#.#...###...#...#...#...#...#.#...#.#
#.###.###.#####.###.#.###.#.#.#.###.#.#.#.#v###.#.#.#.###.#.#v###.###.#.#.#.###.#.#v#####.#####.#.#.#.###.###.###########.#.#.#.###.#.#####.#
#.....###...###.#...#.#...#.#.#.....#...#.>.>.#.#.#.#.#...#.>.>.#.#...#.#.#.###...#...#...#...#.#.#.#...#.###...........#.#...#...#...#...#.#
###########.###.#.###.#.###.#.#############v#.#.#.#.#.#.#####v#.#.#.###.#.#.#########.#.###.#.#.#.#.###.#.#############.#.#######.#####.#.#.#
#.........#...#.#.#...#.#...#...#...###...#.#.#.#.#.#.#.###...#...#...#.#.#...#.......#.#...#.#.#.#.....#.#...#.........#...#...#.###...#.#.#
#.#######.###.#.#.#.###.#.#####.#.#.###.#.#.#.#.#.#.#.#.###.#########.#.#.###.#.#######.#.###.#.#.#######.#.#.#.###########.#.#.#.###.###.#.#
#...#...#.....#...#.....#.......#.#.#...#...#...#.#.#.#.#...#...#####...#...#.#.#.......#...#...#...#...#...#...#...#...###...#.#.#...###...#
###.#.#.#########################.#.#.###########.#.#.#.#.###.#.###########.#.#.#.#########.#######.#.#.#########.#.#.#.#######.#.#.#########
###...#...............#...#...#...#.#...........#.#.#...#.....#.......#.....#.#.#.#.........#.....#...#...........#...#.#.......#...#...#...#
#####################.#.#.#.#.#.###.###########.#.#.#################.#.#####.#.#.#.#########.###.#####################.#.###########.#.#.#.#
#.....................#.#.#.#.#...#.#...........#.#.#.................#...#...#...#...........#...#...............#...#.#.#...........#...#.#
#.#####################.#.#.#.###.#.#.###########.#.#.###################.#.###################.###.#############.#.#.#.#.#.###############.#
#.#.......#.......###...#...#.....#.#.......#...#...#...................#.#.#...#...#...#.....#...#.#.......#...#...#.#.#...###.............#
#.#.#####.#.#####.###.#############.#######.#.#.#######################.#.#.#.#.#.#.#.#.#.###.###.#.#.#####.#.#.#####.#.#######.#############
#.#.#.....#.#.....#...#...#.....###.#...#...#.#.###...#...#.............#...#.#.#.#...#...###.....#...#...#...#.....#...#.......#.......#...#
#.#.#.#####.#.#####.###.#.#.###.###.#.#.#.###.#.###.#.#.#.#v#################.#.#.#####################.#.#########.#####.#######.#####.#.#.#
#...#.......#.....#.....#...###...#...#...#...#.....#...#.>.>.#...#...#...#...#.#.....#...#.....###...#.#.......#...###...#.......#.....#.#.#
#################.###############.#########.###############v#.#.#.#.#.#.#.#.###.#####.#.#.#.###.###.#.#.#######.#.#####.###.#######.#####.#.#
#.................#...#...........#...#...#...............#.#...#.#.#.#.#.#.#...#...#...#...#...#...#...#.....#...#...#.....###...#.......#.#
#.#################.#.#.###########.#.#.#.###############.#.#####.#.#.#.#.#.#.###.#.#########.###.#######.###.#####.#.#########.#.#########.#
#.........#.........#.#.............#...#...#...........#.#...#...#.#.#.#...#.#...#...#.......###...#.....#...#...#.#.#.....#...#...........#
#########.#.#########.#####################.#.#########.#.###.#.###.#.#.#####.#.#####.#.###########.#.#####.###.#.#.#.#.###.#.###############
#.........#.#.........#...#####...#.........#.........#...#...#...#.#.#...#...#.....#.#...#...#####...###...###.#.#.#.#...#.#...............#
#.#########.#.#########.#.#####.#.#.#################.#####.#####.#.#.###.#.#######.#.###v#.#.###########.#####.#.#.#.###.#.###############.#
#.#...#...#.#.......#...#...#...#...###.......###...#.....#.....#.#.#...#.#.#.......#...>.>.#...#####...#.....#.#.#.#...#.#.#.........#...#.#
#.#.#.#.#.#.#######.#.#####.#.#########.#####.###.#.#####.#####.#.#.###.#.#.#.###########v#####.#####.#.#####.#.#.#.###.#.#.#.#######.#.#.#.#
#...#...#...#.......#.#.....#.....#...#.#.....#...#.#.....#.....#...#...#.#...#...###...#.....#...###.#.###...#.#.#.#...#.#.#.......#.#.#.#.#
#############v#######.#.#########.#.#.#.#.#####.###.#.#####.#########.###.#####.#.###.#.#####.###.###.#.###v###.#.#.#.###.#.#######v#.#.#.#.#
#.......#...#.>.#...#.#.###...#...#.#.#.#...#...###...#...#.....#...#...#.#...#.#...#.#...#...#...#...#...>.>.#.#.#.#...#.#.#.....>.#...#...#
#.#####.#.#.#v#.#.#.#.#.###.#.#v###.#.#.###.#.#########.#.#####.#.#.###.#.#.#.#.###.#.###.#.###.###.#######v#.#.#.#.###.#.#.#.#####v#########
#.....#...#...#...#.#.#...#.#.>.>...#.#...#.#.....#.....#.......#.#...#.#.#.#.#...#...#...#.#...#...#.......#...#.#.###.#.#...#...#.........#
#####.#############.#.###.#.###v#####.###.#.#####.#.#############.###.#.#.#.#.###.#####.###.#.###.###.###########.#.###.#.#####.#.#########.#
#...#.........#...#.#.#...#.#...###...#...#.#...#.#...............#...#...#.#.###...###.....#.....###.......#.....#.###.#...#...#.........#.#
#.#.#########.#.#.#.#.#.###.#.#####.###.###.#.#.#.#################.#######.#.#####.#######################.#.#####.###.###.#.###########.#.#
#.#.#...#.....#.#.#...#...#.#.###...#...###...#.#.#.................###...#.#.#...#.........#.......#.......#.....#...#.#...#.......###...#.#
#.#.#.#.#.#####.#.#######.#.#.###.###.#########.#.#.###################.#.#.#.#.#.#########.#.#####.#.###########.###.#.#.#########.###.###.#
#.#.#.#.#.......#.....###...#...#.#...###.....#...#.................#...#...#...#...#...#...#.....#.#.......#...#.....#...#####...#...#.....#
#.#.#.#.#############.#########.#.#.#####.###.#####################.#.#############.#.#.#.#######.#.#######.#.#.###############.#.###.#######
#.#...#.#.......#.....#.........#...#...#...#.#...#...###...#.....#.#...#...#.....#.#.#.#...#...#.#...#.....#.#.#...###.........#...#...#...#
#.#####.#v#####.#.#####.#############.#.###.#.#.#.#.#.###.#.#.###.#.###.#.#.#.###.#.#.#.###.#.#.#.###.#.#####.#.#.#.###.###########.###.#.#.#
#.....#.#.>...#...#...#.............#.#.#...#.#.#.#.#...#.#...###...###...#...#...#...#.....#.#.#...#.#...#...#...#...#...........#.....#.#.#
#####.#.#v###.#####.#.#############.#.#.#.###.#.#.#.###.#.#####################.#############.#.###.#.###.#.#########.###########.#######.#.#
#.....#...###.#...#.#.###...........#.#.#...#.#.#.#.#...#.....#...#.......#.....###.....#...#.#.....#.#...#...#.......#...#...#...#.......#.#
#.###########.#.#.#.#.###.###########.#.###.#.#.#.#.#.#######v#.#.#.#####.#.#######.###.#.#.#.#######.#.#####.#.#######.#.#.#.#v###.#######.#
#...#.......#...#...#...#.#...#...###.#.....#...#.#.#.....#.>.>.#.#.....#.#.#...###.#...#.#.#.......#.#...#...#.#.....#.#.#.#.>.###...#.....#
###.#.#####.###########.#.#.#.#.#.###.###########.#.#####.#.#v###.#####.#.#v#.#.###.#.###.#.#######.#.###v#.###.#.###.#.#.#.###v#####.#.#####
###...#...#.#...........#...#.#.#...#.......#.....#...#...#.#.###.#...#.#.>.>.#...#.#...#.#...#...#.#.#.>.>.#...#...#...#.#.###...#...#.....#
#######.#.#.#.###############.#.###.#######.#.#######.#.###.#.###.#.#.#.###v#####.#.###.#.###.#.#.#.#.#.#v###.#####.#####.#.#####.#.#######.#
#...#...#...#...#.....#...#...#.#...#...#...#.....#...#.....#...#...#.#...#...###...###.#...#.#.#.#.#.#.#...#...#...#.....#.#.....#...#.....#
#.#.#.#########.#.###.#.#.#.###.#.###.#.#.#######.#.###########.#####.###.###.#########.###.#.#.#.#.#.#.###.###.#.###.#####.#.#######.#.#####
#.#.#.......###.#.#...#.#.#...#.#.#...#.#.......#.#...#.........#...#.....###.........#.#...#...#.#.#.#.###...#...###.#...#.#.#...#...#.....#
#.#.#######.###.#.#.###.#.###v#.#.#.###.#######.#.###.#.#########.#.#################.#.#.#######.#.#.#.#####.#######.#.#.#.#.#.#.#.#######.#
#.#.........#...#.#.#...#...>.>.#...###.#...#...#.....#...#...#...#.....#.............#...#.......#.#.#.#...#.......#.#.#.#.#.#.#...###...#.#
#.###########.###.#.#.#######v#########.#.#.#.###########.#.#.#.#######.#.#################.#######.#.#.#.#.#######.#.#.#.#.#.#.#######.#.#.#
#...........#...#.#...#...###.....#...#.#.#...#...#######...#.#.#.......#.................#.......#.#...#.#.#.......#...#...#...#.......#.#.#
###########.###.#.#####.#.#######.#.#.#.#.#####.#.###########.#.#.#######################.#######.#.#####.#.#.###################.#######.#.#
###...#...#.#...#...#...#.........#.#...#.#.....#...#.......#...#.....#...#...#...........#...###...#.....#...#...#...#...###...#.#.....#.#.#
###.#.#.#.#.#.#####.#.#############.#####.#.#######.#.#####.#########.#.#.#.#.#.###########.#.#######.#########.#.#.#.#.#.###.#.#.#.###.#.#.#
#...#...#...#.......#...#.........#.#.....#...#.....#.....#...###.....#.#...#.#.#.....#...#.#.#.....#...........#.#.#...#.#...#.#.#.#...#...#
#.#####################.#.#######.#.#.#######.#.#########.###.###.#####.#####.#.#.###.#.#.#.#.#.###.#############.#.#####.#.###.#.#.#.#######
#...#.....###...###...#.#.#.......#...#...#...#.#.......#...#...#.....#...#...#.#.#...#.#.#.#.#...#.#...#...#.....#.#.....#...#.#...#.......#
###.#.###.###.#.###.#.#.#.#.###########.#.#.###.#.#####.###.###.#####.###.#.###.#.#.###.#.#.#.###.#.#.#.#.#.#v#####.#.#######.#.###########.#
#...#.#...#...#.#...#.#...#...#...#...#.#.#.#...#.#.....###...#.#.....#...#.....#.#.#...#.#.#...#.#.#.#.#.#.>.>.###.#.#...###.#.###...#...#.#
#.###.#v###.###.#.###.#######.#.#.#.#.#.#.#.#.###.#.#########.#.#v#####.#########.#.#.###.#.###.#.#.#.#.#.###v#.###.#.#.#.###.#.###.#.#v#.#.#
#.#...#.>.#.#...#...#.#.......#.#...#.#.#...#...#.#.#...#.....#.>.>.###...#.......#.#.###.#...#.#.#.#.#.#.#...#...#.#.#.#.#...#.....#.>.#...#
#.#.###v#.#.#.#####.#.#.#######.#####.#.#######.#.#.#.#.#.#######v#.#####.#.#######.#.###.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.###########v#####
#...#...#.#.#.#...#.#.#.......#...#...#...#.....#.#...#...#.....#.#.#...#...#.......#...#.#...#.#.#...#.#.#.....#.#.#.#.#...#####...###.#...#
#####.###.#.#.#.#.#.#.#######v###.#.#####.#.#####.#########.###.#.#.#.#.#####.#########.#.#.###.#.#####.#.#####.#.#.#.#.#########.#.###.#.#.#
#...#...#.#.#.#.#.#.#.#.....>.>.#.#.....#.#.#...#.#.........###.#.#...#...###...#.....#.#...###...#...#...###...#...#...#...###...#...#...#.#
#.#.###.#.#.#.#.#.#.#.#.#####v#.#.#####.#.#.#.#.#.#.###########.#.#######.#####.#.###.#.###########.#.#######.###########.#.###.#####.#####.#
#.#.....#.#.#...#.#.#.#.#.....#...#...#...#...#.#.#.....#.....#.#.###.....#...#.#...#.#.......#.....#...#.....#.......#...#.#...#.....#...#.#
#.#######.#.#####.#.#.#.#.#########.#.#########.#.#####.#.###.#.#.###.#####.#.#v###.#.#######.#.#######.#.#####.#####.#.###.#.###.#####.#.#.#
#.......#.#.....#...#.#.#...........#.......#...#...#...#.#...#.#...#.#...#.#.>.>.#.#.#...#...#.#.....#.#.......#.....#...#...###.....#.#.#.#
#######.#.#####.#####.#.###################.#.#####.#.###.#.###.###.#.#.#.#.###v#.#.#.#.#.#.###.#.###.#.#########.#######.###########.#.#.#.#
#.......#.#...#.....#.#.#.......#...#...#...#.#...#.#.#...#...#.#...#...#...#...#.#.#.#.#.#...#...#...#.........#.......#...........#.#.#.#.#
#.#######.#.#.#####.#.#.#.#####.#.#.#.#.#.###.#.#.#.#.#.#####.#.#.###########.###.#.#.#.#.###.#####.###########.#######.###########.#.#.#.#.#
#.......#...#.......#...#.#...#...#...#...###...#.#.#...###...#...###...#.....###...#...#.....#.....#...#...###...#.....#...#.......#...#...#
#######.#################.#.#.###################.#.#######.#########.#.#.#####################.#####.#.#.#.#####.#.#####.#.#.###############
#.......#...#.........#...#.#...#...#...###.....#...###.....###...#...#...#.......#...#...#...#.......#...#...#...#.#.....#...#...#.........#
#.#######.#.#.#######.#.###.###.#.#.#.#.###.###.#######.#######.#.#.#######.#####.#.#.#.#.#.#.###############.#.###.#.#########.#.#.#######.#
#.........#...#.......#.....###...#...#.....#...###...#.....###.#.#.......#.#.....#.#.#.#.#.#.#####...........#...#.#.#.........#...#...#...#
###############.#############################.#####.#.#####.###.#.#######.#.#.#####.#.#.#.#.#.#####.#############.#.#.#.#############.#.#.###
#.............#.#...#...................#.....#...#.#.#####...#.#...#...#...#.......#...#...#.....#.............#...#...###...........#.#...#
#.###########.#.#.#.#.#################.#.#####.#.#.#.#######.#.###.#.#.#########################.#############.###########.###########.###.#
#...........#.#...#.#.#...#...#.......#...#...#.#.#.#.###.....#.#...#.#...........#.....#.........#...#...#...#.....###...#...........#.#...#
###########.#.#####.#.#.#.#.#.#.#####.#####.#.#.#.#.#.###.#####.#.###.###########.#.###.#.#########.#.#.#.#.#.#####.###.#.###########.#.#.###
#...........#.......#...#...#.#.#.....#...#.#...#...#...#.....#.#...#.....#...###.#.###.#.#...#...#.#...#...#.......#...#.............#...###
#.###########################.#.#.#####.#.#.###########.#####.#.###.#####.#.#.###.#.###.#.#.#.#.#.#.#################.#######################
#.#...........#.....#...#.....#.#.....#.#.#.......#.....###...#.#...#.....#.#...#.#.#...#.#.#...#.#.....#...###...###.....#.........#####...#
#.#.#########.#.###.#.#.#.#####.#####.#.#.#######.#.#######v###.#.###.#####.###.#.#.#.###.#.#####.#####.#.#.###.#.#######.#.#######.#####.#.#
#...#.........#.#...#.#.#.......#.....#.#.###...#.#.....#.>.>.#.#...#.......#...#...#...#.#.#.....#####...#.....#.......#...#.....#.....#.#.#
#####.#########.#.###.#.#########.#####.#.###.#.#.#####.#.###.#.###.#########.#########.#.#.#.#########################.#####.###.#####.#.#.#
#.....#...#...#.#.#...#.#.......#...###.#.#...#...#.....#...#.#.#...#...#.....#...#####...#.#...#...#...#.......#.......#...#...#.......#.#.#
#.#####.#.#.#.#.#.#.###.#.#####.###.###.#.#.#######.#######.#.#.#.###.#.#.#####.#.#########.###.#.#.#.#.#.#####.#.#######.#.###.#########.#.#
#.......#.#.#.#.#.#.#...#.....#.#...#...#.#.#...###.......#.#.#.#...#.#.#.....#.#...#...###.#...#.#.#.#.#.....#.#.......#.#.....#.......#.#.#
#########.#.#.#.#.#.#.#######.#.#v###.###.#.#.#.#########.#.#.#.###.#.#.#####.#.###.#.#.###.#.###.#.#.#.#####.#.#######.#.#######.#####.#.#.#
###.......#.#.#.#.#.#.#.....#.#.>.>...#...#...#.........#.#.#...#...#.#.#...#.#.#...#.#.###.#.###.#.#.#.###...#.........#.........#.....#.#.#
###.#######.#.#.#.#.#.#.###.#.#########.###############.#.#.#####.###.#.#.#.#v#.#.###.#.###.#.###.#.#.#.###v#######################.#####.#.#
#...#...#...#.#.#...#.#.###.#...#.......#...#...#...#...#.#.#.....#...#.#.#.>.>.#.#...#.#...#.#...#.#.#.#.>.>...#...###...###.......#...#.#.#
#.###.#.#.###.#.#####.#.###.###.#.#######.#.#.#.#.#.#.###.#.#.#####.###.#.#######.#.###.#.###.#.###.#.#.#.#####.#.#.###.#.###v#######.#.#.#.#
#...#.#.#.#...#...#...#.#...#...#...#...#.#.#.#.#.#.#...#.#.#...#...#...#.....#...#...#.#.###.#...#.#.#.#.#.....#.#.#...#.#.>.###...#.#.#.#.#
###.#.#.#.#.#####.#.###.#.###.#####.#.#.#.#.#.#.#.#.###.#.#.###.#.###.#######.#.#####.#.#.###.###.#.#.#.#.#.#####.#.#.###.#.#v###.#.#.#.#.#.#
###...#...#.......#.....#.....#####...#...#...#...#.....#...###...###.........#.......#...###.....#...#...#.......#...###...#.....#...#...#.#
###########################################################################################################################################.#""".split("\n")

TEST_INPUT = """#S#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#""".split("\n")

class Grid:
    def __init__(self, grid):
        self.grid = []
        self.farmer = None
        for row in range(len(grid)):
            self.grid.append([])
            for col in range(len(grid[0])):
                if(grid[row][col] in "<>^v."):
                    self.grid[row].append(Cell(True))
                elif(grid[row][col] == 'S'):
                    self.grid[row].append(Cell(True))
                    self.farmer = self.grid[row][col]
                    self.farmer.distance = 0
                else:
                    self.grid[row].append(Cell(False))
        for row in range(len(self.grid)):
            for col in range(len(self.grid[row])):
                self.grid[row][col].neighbors = self.get_neighbors(row, col)

    def get_neighbors(self, row, col):
        neighbors = []
        if(row > 0 and self.grid[row-1][col].is_farm()):
            neighbors.append(self.grid[row-1][col])
        if(col > 0 and self.grid[row][col-1].is_farm()):
            neighbors.append(self.grid[row][col-1])
        if(row < len(self.grid)-1 and self.grid[row+1][col].is_farm()):
            neighbors.append(self.grid[row+1][col])
        if(col < len(self.grid[row])-1 and self.grid[row][col+1].is_farm()):
            neighbors.append(self.grid[row][col+1])
        return neighbors
    
    def print(self):
        for row in self.grid:
            row_str = ""
            for cell in row:
                # if(cell.distance < 4096):
                #     row_str += str(cell.distance)
                # else:
                #     row_str += "-"
                if(cell.traversed):
                    row_str += "x"
                elif(cell.is_farm()):
                    row_str += "."
                else:
                    row_str += "#"
            print(row_str)
        print()

class Cell:
    def __init__(self, farm):
        self.farm = farm
        self.neighbors = []
        self.distance = 8192
        self.traversed = False
        self.path = None

    def is_farm(self):
        return self.farm
    
    def get_neighbors(self):
        return self.neighbors

class Traverser:
    def __init__(self):
        pass

    def traverse(self, paths, start, distance):
        start.traversed = True
        if(paths is None):
            paths = {}
        start.path = len(paths)
        paths[start.path] = distance
        queue = [start]
        could_reach = 1
        while(len(queue) > 0):
            cell = queue.pop(0)
            print(paths)
            paths[cell.path]+=1
            if(len(cell.get_neighbors()) >= 3 and not cell.traversed):
                for neighbor in cell.get_neighbors():
                    if(not neighbor.traversed):
                        neighbor.distance = cell.distance+1
                        paths[len(paths)] = self.traverse(paths, neighbor, cell.distance)
            else:
                for neighbor in cell.get_neighbors():
                    if(neighbor.distance > cell.distance+1):# or (neighbor.distance < cell.distance+1 and neighbor.path == cell.path)):
                        queue.append(neighbor)
                        neighbor.path = cell.path
                        neighbor.distance = cell.distance+1
            cell.traversed = True
        print(paths)
        return could_reach

class Path:
    def __init__(self, distance, cell):
        self.distance = distance
        self.cell = cell

if __name__ == "__main__":
    g = Grid(TEST_INPUT)
    g.print()
    print(Traverser().traverse(None, g.farmer, 0))
    g.print()
